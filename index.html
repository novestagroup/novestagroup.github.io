<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Novesta ‚Äì 5‚òÖ Review Generator</title>
  <meta name="description" content="Generate a fresh 5-star review, copy it, and paste on Google Reviews for Novesta Group." />
  <style>
    :root{
      --bg:#0b0f14;
      --card:#0f1620cc;
      --text:#eaf2ff;
      --muted:#a9b6c7;
      --accent:#6ee7ff;
      --accent-2:#a78bfa;
      --border:#1e293b;
      --ok:#22c55e;
      --warn:#f59e0b;
      --error:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text); background: radial-gradient(1200px 800px at 10% 10%, #172133 0%, transparent 70%), radial-gradient(1000px 700px at 100% 0%, #1a2a40 0%, transparent 70%), var(--bg);
    }
    .wrap{max-width:880px; margin:0 auto; padding:28px}
    .hero{
      display:flex; align-items:center; justify-content:space-between; gap:14px; margin-bottom:18px;
    }
    .brand{display:flex; align-items:center; gap:12px}
    .logo{
      width:40px; height:40px; border-radius:12px; background:linear-gradient(135deg, var(--accent), var(--accent-2));
      box-shadow:0 8px 30px #6ee7ff33, inset 0 0 20px #ffffff22;
    }
    h1{font-size:22px; margin:0;}
    .badge{
      display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border:1px solid var(--border);
      border-radius:999px; color:var(--muted); background:#0f172acc; font-size:12px;
    }
    .grid{display:grid; grid-template-columns:1.2fr .8fr; gap:18px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
    .card{
      background:var(--card); border:1px solid var(--border); border-radius:18px; padding:20px;
      box-shadow:0 10px 40px #00000055, inset 0 1px 0 #ffffff10; backdrop-filter: blur(10px);
    }
    .title{font-size:16px; margin:0 0 10px; color:#d7e6ff}
    #review{white-space:pre-wrap; line-height:1.6; font-size:16px; color:#eaf2ff; min-height:120px}
    .buttons{display:flex; flex-wrap:wrap; gap:12px; margin-top:16px}
    button,.linkbtn{
      appearance:none; border:1px solid var(--border); border-radius:12px; padding:12px 16px; font-weight:700;
      background:#0b1220; color:#fff; cursor:pointer; transition:transform .04s ease, box-shadow .2s ease, background .2s ease;
      box-shadow:0 4px 20px #00000040, inset 0 1px 0 #ffffff10;
    }
    button:hover,.linkbtn:hover{transform:translateY(-1px)}
    button.primary{background:linear-gradient(135deg, var(--accent), var(--accent-2)); color:#0b0f14; border-color:#0000}
    button.secondary{background:#0b1220}
    button.ghost{background:transparent}
    button:disabled{opacity:.5; cursor:not-allowed; transform:none}
    .hint{color:var(--muted); font-size:13px; margin-top:10px}
    .steps{display:flex; gap:12px; margin-top:10px; flex-wrap:wrap}
    .step{flex:1; min-width:180px; background:#0b1220; border:1px dashed var(--border); border-radius:12px; padding:12px}
    .step b{display:block; margin-bottom:6px; color:#dce7ff}
    .cta{
      display:flex; flex-direction:column; gap:14px
    }
    .big{
      display:flex; align-items:center; justify-content:center; gap:10px; text-decoration:none;
      padding:14px 16px; border-radius:14px; background:linear-gradient(135deg, #22d3ee, #a78bfa);
      color:#0b0f14; font-weight:900; letter-spacing:.3px; border:0; box-shadow:0 10px 40px #6ee7ff33;
    }
    .small{font-size:12px; color:var(--muted)}
    .toast{
      position:fixed; left:50%; bottom:22px; transform:translateX(-50%); background:#0b1220; color:#fff;
      border:1px solid var(--border); border-radius:12px; padding:10px 14px; box-shadow:0 10px 30px #0008; display:none;
    }
    .kbd{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; background:#0b1220; border:1px solid var(--border); padding:2px 6px; border-radius:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Novesta 5‚òÖ Review Generator</h1>
          <div class="badge"><span id="remaining">‚Ä¶</span> left</div>
        </div>
      </div>
    </div>

    <div class="grid">
      <!-- Generator -->
      <section class="card">
        <h2 class="title">Your review</h2>
        <div id="review">Click <b>Generate</b> to get a fresh 5-star review. After you press <b>Copy & Reserve</b>, this review won‚Äôt appear for anyone else.</div>
        <div class="buttons">
          <button id="genBtn" class="primary">‚ö° Generate</button>
          <button id="copyBtn" class="secondary" disabled>üìã Copy & Reserve</button>
          <a id="openBtn" class="linkbtn ghost" target="_blank" rel="noopener">‚Üó Open Google Review Page</a>
        </div>
        <div class="hint" id="hint"></div>

        <div class="steps">
          <div class="step">
            <b>1) Generate</b>
            Tap <span class="kbd">Generate</span> for a new, unused review.
          </div>
          <div class="step">
            <b>2) Copy</b>
            Click <span class="kbd">Copy & Reserve</span> ‚Äî it copies the text and locks it for you.
          </div>
          <div class="step">
            <b>3) Paste & Post</b>
            Hit <span class="kbd">Open Google Review Page</span> and paste the review in the text box there.
          </div>
        </div>
      </section>

      <!-- CTA & Info -->
      <aside class="card cta">
        <h2 class="title">Post your review here</h2>
        <a class="big" id="reviewLink" href="https://g.page/r/CQo8pe9HyhYeEBM/review" target="_blank" rel="noopener">
          ‚≠ê Open Google Review Page
        </a>
        <div class="small">
          Tip: after pasting, feel free to add your own words or emojis to make it personal before you submit.
        </div>
        <div class="small">
          Need another line? Generate again. Once copied, a review is removed from the pool to avoid duplicates.
        </div>
      </aside>
    </div>
  </div>

  <div class="toast" id="toast">Copied to clipboard</div>

  <script>
    // API endpoint (Apps Script Web App URL ending with /exec)
    const API = "https://script.google.com/macros/s/AKfycby0o_oETDhpXCcicTv-BArsz-9ghW5YBUp5pXIFDFyhkyTh9iMDcyivRXKi1i5B9FCPog/exec";

    // Where to paste (Google review link)
    const REVIEW_URL = "https://g.page/r/CQo8pe9HyhYeEBM/review";

    const reviewEl   = document.getElementById('review');
    const genBtn     = document.getElementById('genBtn');
    const copyBtn    = document.getElementById('copyBtn');
    const hint       = document.getElementById('hint');
    const remaining  = document.getElementById('remaining');
    const openBtn    = document.getElementById('openBtn');
    const reviewLink = document.getElementById('reviewLink');
    const toast      = document.getElementById('toast');

    openBtn.href = REVIEW_URL;
    reviewLink.href = REVIEW_URL;

    let current = { id: null, text: "" };

    function showToast(msg){
      toast.textContent = msg || 'Done';
      toast.style.display = 'block';
      setTimeout(()=> toast.style.display = 'none', 1600);
    }

    async function getRemaining() {
      try {
        const res = await fetch(API + "?action=count", { cache: "no-store" });
        const data = await res.json();
        remaining.textContent = data.ok ? data.remaining : '‚Ä¶';
      } catch {
        remaining.textContent = '‚Ä¶';
      }
    }

    async function generate() {
      hint.textContent = '';
      copyBtn.disabled = true;
      current = { id: null, text: "" };
      reviewEl.textContent = 'Finding a fresh review‚Ä¶';

      try {
        const res = await fetch(API + "?action=next", { cache: "no-store" });
        const data = await res.json();
        if (data.ok && !data.empty) {
          current.id = data.id;
          current.text = data.review;
          reviewEl.textContent = data.review;
          copyBtn.disabled = false;
          await getRemaining();
        } else {
          reviewEl.textContent = 'No reviews left. Please ask admin to add more.';
          copyBtn.disabled = true;
        }
      } catch {
        reviewEl.textContent = 'Error fetching review. Try again.';
      }
    }

    async function copyAndReserve() {
      if (!current.id || !current.text) return;
      // Copy to clipboard
      try {
        await navigator.clipboard.writeText(current.text);
      } catch {
        const ta = document.createElement('textarea');
        ta.value = current.text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
      }
      showToast('Copied to clipboard');

      hint.textContent = 'Reserving this review so it won‚Äôt appear again‚Ä¶';
      try {
        const form = new FormData();
        form.append('id', String(current.id));
        const res = await fetch(API, { method: 'POST', body: form });
        const data = await res.json();
        if (data.ok) {
          hint.textContent = 'Reserved. Now click ‚ÄúOpen Google Review Page‚Äù and paste.';
          copyBtn.disabled = true;
          current = { id: null, text: "" };
          await getRemaining();
          // Nudge user to the Google page
          window.open(REVIEW_URL, '_blank', 'noopener');
        } else {
          hint.textContent = 'Someone used this at the same time. Please generate another.';
        }
      } catch {
        hint.textContent = 'Could not reserve. Try generating a new one.';
      }
    }

    genBtn.addEventListener('click', generate);
    copyBtn.addEventListener('click', copyAndReserve);
    getRemaining();
  </script>
</body>
</html>
